<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Relleno</title>
    <!-- Incluimos Tailwind CSS para un estilo moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Importamos la fuente Inter desde Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        /* Estilo personalizado para usar la fuente Inter y asegurar un fondo agradable */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <link rel="manifest" href="manifest.json">
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
            Calculadora de Relleno
        </h1>

        <!-- Sección de campos de entrada -->
        <div class="space-y-6 mb-8">
            <!-- Campo: Cantidad de BU por orden -->
            <div>
                <label for="bu_por_orden" class="block text-sm font-medium text-gray-700">Cantidad de BU por orden</label>
                <input type="number" id="bu_por_orden" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="Ej: 50000">
            </div>

            <!-- Campo: BU realizados -->
            <div>
                <label for="bu_realizados" class="block text-sm font-medium text-gray-700">BU realizados</label>
                <input type="number" id="bu_realizados" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="Ej: 38000">
            </div>

            <!-- Campo: Suma % de tanque mezclador y premezclador -->
            <div>
                <label for="suma_tanque" class="block text-sm font-medium text-gray-700">Suma % de tanque mezclador y premezclador</label>
                <input type="number" id="suma_tanque" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="Ej: 70">
            </div>

            <!-- Campo: Cocinador con validación -->
            <div>
                <label for="cocinador" class="block text-sm font-medium text-gray-700">Cocinador</label>
                <input type="number" id="cocinador" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="Ej: 0" min="0" max="1">
                <p id="cocinador_error" class="text-red-500 text-xs mt-1 hidden">El valor debe ser 0 o 1.</p>
            </div>
        </div>

        <!-- Botón de cálculo -->
        <div class="flex justify-center">
            <button id="btn_calcular" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200">
                Calcular
            </button>
        </div>

        <!-- Sección de resultados -->
        <div class="mt-8 bg-blue-50 p-6 rounded-xl shadow-inner border border-blue-100">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Resultados</h2>
            <div class="space-y-3 text-gray-700">
                <div class="flex justify-between items-center">
                    <span class="font-medium">Relleno faltante:</span>
                    <span id="relleno_faltante" class="text-lg font-bold text-blue-600">0.00 Kg</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Horas faltantes:</span>
                    <span id="horas_faltantes" class="text-lg font-bold text-blue-600">0.00</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Preparaciones faltantes:</span>
                    <span id="preparaciones_faltantes" class="text-lg font-bold text-blue-600">0.00</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Horario de corte:</span>
                    <span id="horario_corte" class="text-lg font-bold text-blue-600">--:--</span>
                </div>
                <!-- Nuevo elemento para el mensaje de corte de horas -->
                <div class="text-center mt-4">
                    <p id="mensaje_corte_horas" class="text-sm font-semibold text-green-600 hidden">
                        ¡Se necesita solo 1 preparación para las horas restantes!
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pie de página con derechos de autor y redes sociales -->
    <footer class="mt-8 text-center text-gray-500 text-sm">
        <p class="mb-2">
            &copy; 2024 Todos los derechos reservados.
        </p>
        <div class="flex justify-center space-x-4">
            <a href="https://www.instagram.com/itz.lihu/" target="_blank" class="hover:text-blue-600 transition-colors">Instagram</a>
            <a href="https://github.com/LihueCasella" target="_blank" class="hover:text-blue-600 transition-colors">GitHub</a>
            <a href="https://wa.me/+5492657319151" target="_blank" class="hover:text-blue-600 transition-colors">WhatsApp</a>
            <a href="https://www.linkedin.com/in/lihuecasella/" target="_blank" class="hover:text-blue-600 transition-colors">LinkedIn</a>
        </div>
    </footer>

    <script>
        // Lógica de JavaScript para la calculadora
        document.addEventListener('DOMContentLoaded', () => {
            // Constantes y valores de tu hoja de cálculo
            const rellenoKgPorHrBase = 263.34;
            const buPorHr = 1672;
            const horasPorPreparacion = 2.445; // Valor inferido: 6.89 / 2.81
            
            // Referencias a los elementos del DOM (inputs y displays)
            const buPorOrdenInput = document.getElementById('bu_por_orden');
            const buRealizadosInput = document.getElementById('bu_realizados');
            const cocinadorInput = document.getElementById('cocinador');
            const calcularBtn = document.getElementById('btn_calcular');
            const rellenoFaltanteSpan = document.getElementById('relleno_faltante');
            const horasFaltantesSpan = document.getElementById('horas_faltantes');
            const preparacionesFaltantesSpan = document.getElementById('preparaciones_faltantes');
            const horarioCorteSpan = document.getElementById('horario_corte');
            const cocinadorErrorP = document.getElementById('cocinador_error');
            const mensajeCorteHorasP = document.getElementById('mensaje_corte_horas');
            
            // Función para realizar el cálculo principal
            const calcular = () => {
                const buPorOrden = parseFloat(buPorOrdenInput.value) || 0;
                const buRealizados = parseFloat(buRealizadosInput.value) || 0;
                const cocinador = parseFloat(cocinadorInput.value);
                
                // --- Validación para el campo Cocinador ---
                if (cocinador !== 0 && cocinador !== 1) {
                    cocinadorErrorP.classList.remove('hidden');
                    rellenoFaltanteSpan.textContent = '0.00 Kg';
                    horasFaltantesSpan.textContent = '0.00';
                    preparacionesFaltantesSpan.textContent = '0.00';
                    horarioCorteSpan.textContent = '--:--';
                    mensajeCorteHorasP.classList.add('hidden');
                    return; 
                } else {
                    cocinadorErrorP.classList.add('hidden');
                }
                
                const buFaltantes = buPorOrden - buRealizados;
                const rellenoKgPorHrActual = rellenoKgPorHrBase;

                if (buFaltantes > 0 && buPorHr > 0 && rellenoKgPorHrActual > 0) {
                    const relleno = buFaltantes * (rellenoKgPorHrActual / buPorHr);
                    rellenoFaltanteSpan.textContent = `${relleno.toFixed(2)} Kg`;

                    const horas = relleno / rellenoKgPorHrActual;
                    horasFaltantesSpan.textContent = horas.toFixed(2);

                    let preparaciones = 0;
                    if (horasPorPreparacion > 0) {
                        // Lógica de corte para las preparaciones
                        if (horas <= 2.81) { // 6.89/2.81 = 2.45
                            preparaciones = 1;
                            mensajeCorteHorasP.classList.remove('hidden');
                        } else {
                            preparaciones = horas / horasPorPreparacion;
                            mensajeCorteHorasP.classList.add('hidden');
                        }
                        
                        // Lógica para restar 1 si el cocinador es 1
                        if (cocinador === 1) {
                            preparaciones -= 1;
                        }
                        
                        preparaciones = Math.max(0, preparaciones);
                        preparacionesFaltantesSpan.textContent = preparaciones.toFixed(2);
                    }

                    // --- Cálculo del horario de corte ---
                    const horasFaltantes = parseFloat(horasFaltantesSpan.textContent);
                    const horasRestantesAjustadas = horasFaltantes - (17 / 60);
                    const horaActual = new Date();
                    const horasTotales = horaActual.getHours() + (horasActuales.getMinutes() / 60) + horasRestantesAjustadas;

                    const horasCorte = Math.floor(horasTotales);
                    const minutosCorte = Math.round((horasTotales - horasCorte) * 60);

                    const horaFormateada = String(horasCorte).padStart(2, '0');
                    const minutosFormateados = String(minutosCorte).padStart(2, '0');
                    horarioCorteSpan.textContent = `${horaFormateada}:${minutosFormateados}`;

                } else {
                    rellenoFaltanteSpan.textContent = '0.00 Kg';
                    horasFaltantesSpan.textContent = '0.00';
                    preparacionesFaltantesSpan.textContent = '0.00';
                    horarioCorteSpan.textContent = '--:--';
                    mensajeCorteHorasP.classList.add('hidden');
                }
            };
            
            // Escuchar los eventos de entrada de datos
            buPorOrdenInput.addEventListener('input', calcular);
            buRealizadosInput.addEventListener('input', calcular);
            cocinadorInput.addEventListener('input', calcular);
            
            // Escuchar el evento de clic en el botón
            calcularBtn.addEventListener('click', calcular);
            
            // Inicializar al cargar la página
            calcular();
            
        });
    </script>
</body>
</html>
