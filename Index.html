<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Relleno</title>
    <!-- Incluimos Tailwind CSS para un estilo moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Importamos la fuente Inter desde Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        /* Estilo personalizado para el cuerpo de la página */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            position: relative;
            min-height: 100vh;
        }

        /* Contenedor principal de la calculadora */
        .calculator-container {
            position: relative;
            z-index: 10;
        }

        /* Estilo para los logos de fondo */
        .logo-bottom-left {
            position: fixed;
            bottom: -50px;
            left: -50px;
            width: 250px;
            opacity: 0.15;
            transform: rotate(-30deg);
            z-index: 0;
            user-select: none;
            pointer-events: none;
        }
        
        .logo-bottom-right {
            position: fixed;
            bottom: -50px;
            right: -50px;
            width: 250px;
            opacity: 0.15;
            transform: rotate(30deg);
            z-index: 0;
            user-select: none;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-[#f0f2f5] flex flex-col items-center justify-center p-4">

    <!-- Logos de fondo con los colores corregidos -->
    <img src="https://i.imgur.com/G3j9wQO.png" alt="Logo Izquierda" class="logo-bottom-left">
    <img src="https://i.imgur.com/83p56P5.png" alt="Logo Derecha" class="logo-bottom-right">

    <div class="calculator-container bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm mt-8 mb-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
            Calculadora de Relleno
        </h1>

        <!-- Sección de hora actual -->
        <div class="mb-6 text-center">
            <h2 class="text-lg font-semibold text-gray-700">Hora actual</h2>
            <p id="hora_actual_display" class="text-xl font-bold text-[#1B65A6]">--:--</p>
        </div>

        <!-- Sección de campos de entrada -->
        <div class="space-y-6 mb-8">
            <!-- Campo: Cantidad de BU por orden -->
            <div>
                <label for="bu_por_orden" class="block text-sm font-medium text-gray-700">Cantidad de BU por orden</label>
                <input type="number" id="bu_por_orden" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-[#1B65A6] focus:border-[#1B65A6] transition-colors" placeholder="Ej: 50000">
            </div>

            <!-- Campo: BU realizados -->
            <div>
                <label for="bu_realizados" class="block text-sm font-medium text-gray-700">BU realizados</label>
                <input type="number" id="bu_realizados" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-[#1B65A6] focus:border-[#1B65A6] transition-colors" placeholder="Ej: 38000">
            </div>

            <!-- Campo: Suma % de tanque mezclador y premezclador -->
            <div>
                <label for="suma_tanque" class="block text-sm font-medium text-gray-700">Suma % de tanque mezclador y premezclador</label>
                <input type="number" id="suma_tanque" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-[#1B65A6] focus:border-[#1B65A6] transition-colors" placeholder="Ej: 70">
            </div>

            <!-- Campo: Cocinador con validación -->
            <div>
                <label for="cocinador" class="block text-sm font-medium text-gray-700">Cocinador</label>
                <input type="number" id="cocinador" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-[#1B65A6] focus:border-[#1B65A6] transition-colors" placeholder="Ej: 0" min="0" max="1">
                <p id="cocinador_error" class="text-red-500 text-xs mt-1 hidden">El valor debe ser 0 o 1.</p>
            </div>
        </div>

        <!-- Botones de cálculo y limpieza -->
        <div class="flex justify-center space-x-4">
            <button id="btn_calcular" class="bg-[#1B65A6] text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-[#1B65A6] focus:ring-opacity-50 transition-all duration-200">
                Calcular
            </button>
            <button id="btn_limpiar" class="bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition-all duration-200">
                Limpiar
            </button>
        </div>

        <!-- Sección de resultados -->
        <div class="mt-8 bg-[#1F82BF] bg-opacity-10 p-6 rounded-xl shadow-inner border border-blue-100">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Resultados</h2>
            <div class="space-y-3 text-gray-700">
                <div class="flex justify-between items-center">
                    <span class="font-medium">Relleno faltante:</span>
                    <span id="relleno_faltante" class="text-lg font-bold text-[#1B65A6]">0.00 Kg</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Horas faltantes:</span>
                    <span id="horas_faltantes" class="text-lg font-bold text-[#1B65A6]">0.00</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Preparaciones faltantes:</span>
                    <span id="preparaciones_faltantes" class="text-lg font-bold text-[#1B65A6]">0.00</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-medium">Horario de corte en CC:</span>
                    <span id="horario_corte" class="text-lg font-bold text-[#1B65A6]">--:--</span>
                </div>
                <!-- Nuevo elemento para el mensaje de corte de horas -->
                <div class="text-center mt-4">
                    <p id="mensaje_corte_horas" class="text-sm font-semibold text-green-600 hidden">
                        ¡Se necesita solo 1 preparación para las horas restantes!
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pie de página con derechos de autor y redes sociales -->
    <footer class="mt-8 text-center text-gray-500 text-sm">
        <p class="mb-2">
            &copy; 2024 Todos los derechos reservados.
        </p>
        <div class="flex justify-center space-x-4">
            <a href="https://www.instagram.com/itz.lihu/" target="_blank" class="hover:text-[#F2A922] transition-colors">Instagram</a>
            <a href="https://github.com/LihueCasella" target="_blank" class="hover:text-[#F2A922] transition-colors">GitHub</a>
            <a href="https://wa.me/+5492657319151" target="_blank" class="hover:text-[#F2A922] transition-colors">WhatsApp</a>
            <a href="https://www.linkedin.com/in/lihuecasella/" target="_blank" class="hover:text-[#F2A922] transition-colors">LinkedIn</a>
        </div>
    </footer>

    <script>
        // Lógica de JavaScript para la calculadora
        document.addEventListener('DOMContentLoaded', () => {
            // Constantes y valores de tu hoja de cálculo
            const rellenoKgPorHrBase = 263.34;
            const buPorHr = 1672;
            const horasPorPreparacion = 2.445;
            
            // Referencias a los elementos del DOM (inputs y displays)
            const buPorOrdenInput = document.getElementById('bu_por_orden');
            const buRealizadosInput = document.getElementById('bu_realizados');
            const sumaTanqueInput = document.getElementById('suma_tanque');
            const cocinadorInput = document.getElementById('cocinador');
            const calcularBtn = document.getElementById('btn_calcular');
            const limpiarBtn = document.getElementById('btn_limpiar');
            const rellenoFaltanteSpan = document.getElementById('relleno_faltante');
            const horasFaltantesSpan = document.getElementById('horas_faltantes');
            const preparacionesFaltantesSpan = document.getElementById('preparaciones_faltantes');
            const horarioCorteSpan = document.getElementById('horario_corte');
            const cocinadorErrorP = document.getElementById('cocinador_error');
            const mensajeCorteHorasP = document.getElementById('mensaje_corte_horas');
            const horaActualDisplay = document.getElementById('hora_actual_display');

            // Función para mostrar la hora actual y actualizarla cada minuto
            const mostrarHoraActual = () => {
                const now = new Date();
                let horas = now.getHours();
                const minutos = now.getMinutes();
                const ampm = horas >= 12 ? 'PM' : 'AM';
                horas = horas % 12;
                horas = horas ? horas : 12; // La hora '0' debe ser '12'
                const minutosFormateados = String(minutos).padStart(2, '0');
                horaActualDisplay.textContent = `${horas}:${minutosFormateados} ${ampm}`;
            };
            
            // Función para limpiar todos los campos y resultados
            const limpiarCampos = () => {
                buPorOrdenInput.value = '';
                buRealizadosInput.value = '';
                sumaTanqueInput.value = '';
                cocinadorInput.value = '';
                rellenoFaltanteSpan.textContent = '0.00 Kg';
                horasFaltantesSpan.textContent = '0.00';
                preparacionesFaltantesSpan.textContent = '0.00';
                horarioCorteSpan.textContent = '--:--';
                cocinadorErrorP.classList.add('hidden');
                mensajeCorteHorasP.classList.add('hidden');
                buPorOrdenInput.focus(); // Opcional: enfocar el primer campo para una mejor UX
            };

            // Función para realizar el cálculo principal
            const calcular = () => {
                const buPorOrden = parseFloat(buPorOrdenInput.value) || 0;
                const buRealizados = parseFloat(buRealizadosInput.value) || 0;
                const cocinador = parseFloat(cocinadorInput.value);
                
                // --- Validación para el campo Cocinador ---
                if (cocinador !== 0 && cocinador !== 1) {
                    cocinadorErrorP.classList.remove('hidden');
                    rellenoFaltanteSpan.textContent = '0.00 Kg';
                    horasFaltantesSpan.textContent = '0.00';
                    preparacionesFaltantesSpan.textContent = '0.00';
                    horarioCorteSpan.textContent = '--:--';
                    mensajeCorteHorasP.classList.add('hidden');
                    return; 
                } else {
                    cocinadorErrorP.classList.add('hidden');
                }
                
                const buFaltantes = buPorOrden - buRealizados;
                const rellenoKgPorHrActual = rellenoKgPorHrBase;

                if (buFaltantes > 0 && buPorHr > 0 && rellenoKgPorHrActual > 0) {
                    const relleno = buFaltantes * (rellenoKgPorHrActual / buPorHr);
                    rellenoFaltanteSpan.textContent = `${relleno.toFixed(2)} Kg`;

                    const horas = relleno / rellenoKgPorHrActual;
                    horasFaltantesSpan.textContent = horas.toFixed(2);

                    let preparaciones = 0;
                    if (horasPorPreparacion > 0) {
                        // Lógica de corte para las preparaciones
                        if (horas <= 2.81) {
                            preparaciones = 1;
                            mensajeCorteHorasP.classList.remove('hidden');
                        } else {
                            preparaciones = horas / horasPorPreparacion;
                            mensajeCorteHorasP.classList.add('hidden');
                        }
                        
                        // Lógica para restar 1 si el cocinador es 1
                        if (cocinador === 1) {
                            preparaciones -= 1;
                        }
                        
                        preparaciones = Math.max(0, preparaciones);
                        preparacionesFaltantesSpan.textContent = preparaciones.toFixed(2);
                    }

                    // --- Cálculo del horario de corte usando la fórmula corregida ---
                    const horasFaltantes = parseFloat(horasFaltantesSpan.textContent);
                    const now = new Date();

                    // Convertimos las horas de la fórmula a minutos para sumarlas a la hora actual
                    const minutosParaSumar = (horasFaltantes - (17 / 60)) * 60;
                    
                    // Ajustar la hora actual sumando los minutos calculados
                    now.setMinutes(now.getMinutes() + minutosParaSumar);

                    let horasCorte = now.getHours();
                    let minutosCorte = now.getMinutes();

                    const ampm = horasCorte >= 12 ? 'PM' : 'AM';
                    horasCorte = horasCorte % 12;
                    horasCorte = horasCorte ? horasCorte : 12; // La hora '0' debe ser '12'
                    
                    const horasFormateadas = String(horasCorte).padStart(2, '0');
                    const minutosFormateados = String(minutosCorte).padStart(2, '0');
                    horarioCorteSpan.textContent = `${horasFormateadas}:${minutosFormateados} ${ampm}`;

                } else {
                    rellenoFaltanteSpan.textContent = '0.00 Kg';
                    horasFaltantesSpan.textContent = '0.00';
                    preparacionesFaltantesSpan.textContent = '0.00';
                    horarioCorteSpan.textContent = '--:--';
                    mensajeCorteHorasP.classList.add('hidden');
                }
            };
            
            // --- Event Listeners ---
            // Escuchar los eventos de entrada de datos en todos los campos relevantes
            buPorOrdenInput.addEventListener('input', calcular);
            buRealizadosInput.addEventListener('input', calcular);
            cocinadorInput.addEventListener('input', calcular);
            
            // Escuchar el evento de clic en los botones
            calcularBtn.addEventListener('click', calcular);
            limpiarBtn.addEventListener('click', limpiarCampos); // Nuevo: Evento para el botón de limpiar

            // Llama a las funciones al cargar la página
            mostrarHoraActual();
            setInterval(mostrarHoraActual, 60000); // Actualiza cada 60 segundos
            limpiarCampos(); // Nuevo: Limpia los campos al cargar la página
        });
    </script>
</body>
</html>
